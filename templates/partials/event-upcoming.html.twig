{% set hasEvents = event.header.events is defined %}
{% set upcoming = hasEvents ? event.header.events|filter(i => date(i.dtend) >= date())|first : event.header %}

<div class="card indicator overflow-visible mt-10 w-full bg-base-200 shadow-md">
	<div class="indicator-item indicator-center w-20 h-20 mask mask-squircle flex flex-col items-center justify-center bg-primary text-primary-content filter drop-shadow-md">
		<div class="font-extrabold text-xl">{{ upcoming.dtstart|date('d')}}</div>
		<div class="font-light -mt-1">{{ upcoming.dtstart|date('M')}}</div>
	</div>
	<div class="card-body mt-6">
		<div class="text-center mb-5">
			<div class="uppercase font-semibold tracking-wider text-sm text-primary opacity-80">{{ event.taxonomy.category|first }}</div>
			<h2 class="card-title mb-0 text-center"><a href="{{event.url}}">{{ event.title }}</a></h2>
			<div class="mt-2">
				{% for group in event.taxonomy.group %}
					<a class="badge badge-secondary" href="/{{group|lower}}">
						{{ group }}
					</a>
				{% endfor %}
			</div>
		</div>

		<div class="text-center text-lg font-medium">
			{{ hasEvents ? upcoming.title : event.header.subtitle }}
		</div>

		<dl>
			<dt>Begrüssung</dt>
			<dl class="flex flex-wrap">
				<div class="font-medium mr-2">{{ upcoming.dtstart|startEndTime(upcoming.dtend) }}</div>
				<div class="font-light">{{ upcoming.locstart ?? event.header.locstart ?? config.theme.event.location }}</div>
			</dl>

			<dt>Verabschiedung</dt>
			<dl class="flex flex-wrap">
				<div class="font-medium mr-2">{{ upcoming.dtend|startEndTime(upcoming.dtstart) }}</div>
				<div class="font-light">{{ upcoming.locend ?? upcoming.locstart ?? event.header.locend ?? event.header.locstart ?? config.theme.event.location }}</div>
			</dl>
		</dl>
		<div class="flex justify-center mt-4">
			<a class="link link-hover" href="{{ event.url }}">Details</a>
		</div>
		{% if event.header.events %}
			<div class="font-light text-sm mt-4 text-center">
				{{ event.taxonomy.category|first }} "{{ event.title }}" enthält {{ event.header.events|count }} Anlässe vom
				{{ event.header.dtstart|startEnd(event.header.dtend) }}
			</div>
		{% endif %}
	</div>
</div>
