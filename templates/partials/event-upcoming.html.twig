{% set hasEvents = event.header.events is defined %}
{% set upcoming = hasEvents ? event.header.events|filter(i => date(i.dtend) >= date())|first : event.header %}

<div class="card indicator overflow-visible mt-10 w-full bg-secondary text-secondary-content shadow-md">
	<div class="indicator-item indicator-center w-20 h-20 mask mask-squircle flex flex-col items-center justify-center bg-secondary-focus text-secondary-content filter drop-shadow-md">
		<div class="font-extrabold text-xl">{{ upcoming.dtstart|date('d')}}</div>
		<div class="font-light -mt-1">{{ upcoming.dtstart|date('M')}}</div>
	</div>
	<div class="card-body mt-6">
		<div class="text-center mb-5">
			<div class="uppercase font-semibold tracking-wider text-sm">{{ event.taxonomy.category|first }}</div>
			<h2 class="card-title mb-0 text-center">{{ upcoming.title }}</h2>
			<div class="mt-2">
				{% for group in event.taxonomy.group %}
					<a class="badge badge-outline" href="/{{group|lower}}">
						{{ group }}
					</a>
				{% endfor %}
			</div>
		</div>
		<div class="space-y-1">
			<div class="flex">
				<div class="badge badge-ghost mr-4">Start</div>
				<div class="flex flex-wrap">
					<div class="flex items-center mr-2">
						{{ svg('theme://svg/icon/calendar-time.svg','icon w-5 mr-1 flex-none')|raw }}
						<div>{{ upcoming.dtstart|date('d.m.y G:i') }}</div>
					</div>
					<div class="flex items-center font-light leading-4">
						{{ svg('theme://svg/icon/map-pin.svg','icon w-5 mr-1 flex-none')|raw }}
						<div>{{ upcoming.locstart ?? event.header.locstart ?? 'Keine Angabe.' }}</div>
					</div>
				</div>
			</div>
			<div class="flex">
				<div class="badge badge-ghost mr-4">Ende</div>
				<div class="flex flex-wrap">
					<div class="flex items-center mr-2">
						{{ svg('theme://svg/icon/calendar-time.svg','icon w-5 mr-1 flex-none')|raw }}
						<div>{{ upcoming.dtend|date('d.m.y G:i') }}</div>
					</div>
					<div class="flex font-light leading-4 items-center">
						{{ svg('theme://svg/icon/map-pin.svg','icon w-5 mr-1 flex-none')|raw }}
						<div>{{ upcoming.locend ?? upcoming.locstart ?? event.header.locend ?? event.header.locstart ?? 'Keine Angabe.' }}</div>
					</div>
				</div>
			</div>
			{% if upcoming.note %}
				<div>
					<span class="badge badge-ghost mr-4">Anmerkung</span>
					{{ upcoming.note}}
				</div>
			{% endif %}
			{% if upcoming.cost %}
				<div>
					<span class="badge badge-ghost mr-3">Kosten</span>
					CHF
					{{ upcoming.cost.amount }}
					{{ upcoming.cost.note }}
				</div>
			{% endif %}
		</div>
		<div class="flex justify-center mt-2">
			<a class="btn btn-ghost btn-sm" href="{{ event.url }}">Details</a>
		</div>
		{% if event.header.events %}
			<div class="font-light text-sm mt-4 text-center">
				{{ event.taxonomy.category|first }} "{{ event.title }}" enthält {{ event.header.events|count }} Anlässe vom
				{{ event.header.dtstart|startEnd(event.header.dtend) }}
			</div>
		{% endif %}
	</div>
</div>
